(()=>{"use strict";function e(e){e.classList.add("popup_is-opened"),document.addEventListener("keydown",n)}function t(e){e.classList.remove("popup_is-opened"),document.removeEventListener("keydown",n)}function n(e){"Escape"===e.key&&t(document.querySelector(".popup_is-opened"))}var o={baseUrl:"https://nomoreparties.co/v1/wff-cohort-12",headers:{authorization:"8bd44f34-b673-4f30-b159-1ef27b46d350","Content-Type":"application/json"}};function r(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}var c=document.querySelector("#card-template").content;function a(e,t,n){var o=c.querySelector(".card").cloneNode(!0),r=o.querySelector(".card__delete-button"),a=o.querySelector(".card__image"),i=o.querySelector(".card__like-button"),s=o.querySelector(".card__likes-amount"),l=e._id;return a.src=e.link,a.alt=e.name,o.querySelector(".card__title").textContent=e.name,s.textContent=e.likes?e.likes.length:0,i.addEventListener("click",(function(e){return n.likeCard(e,l,n)})),e.likes.some((function(e){return e.id===t}))&&i.classList.add("card__like-button_is-active"),e.user._id!==t?r.remove():r.addEventListener("click",(function(){return n.deleteCard(o,l)})),a.addEventListener("click",(function(){return n.openImagePopup(e)})),o}function i(e,t){var n;e.target.classList.contains("card__like-button_is-active")&&e.target.classList.contains("card__like-button")?(n=t.id,void fetch("".concat(o.baseUrl,"/cards/likes/").concat(n),{method:"DELETE",headers:o.headers}).then(r).catch((function(e){console.log(e)}))).then((function(n){console.log(n),e.target.classList.toggle("card__like-button_is-active"),t.querySelector(".card__likes-amount").textContent=n.likes.length})).catch((function(e){console.log(e)})):e.target.classList.contains("card__like-button")&&function(e){fetch("".concat(o.baseUrl,"/cards/likes/").concat(e),{method:"PUT",headers:o.headers}).then(r).catch((function(e){console.log(e)}))}(t.id).then((function(n){console.log(n),e.target.classList.toggle("card__like-button_is-active"),t.querySelector(".card__likes-amount").textContent=n.likes.length})).catch((function(e){console.log(e)}))}function s(e){var t;(t=e.id,fetch("".concat(o.baseUrl,"/cards/").concat(t),{method:"DELETE",headers:o.headers}).then(r)).then((function(t){console.log(t),e.remove()})).catch((function(e){console.log(e)}))}var l=[{name:"Архыз",link:"https://pictures.s3.yandex.net/frontend-developer/cards-compressed/arkhyz.jpg"},{name:"Челябинская область",link:"https://pictures.s3.yandex.net/frontend-developer/cards-compressed/chelyabinsk-oblast.jpg"},{name:"Иваново",link:"https://pictures.s3.yandex.net/frontend-developer/cards-compressed/ivanovo.jpg"},{name:"Камчатка",link:"https://pictures.s3.yandex.net/frontend-developer/cards-compressed/kamchatka.jpg"},{name:"Холмогорский район",link:"https://pictures.s3.yandex.net/frontend-developer/cards-compressed/kholmogorsky-rayon.jpg"},{name:"Байкал",link:"https://pictures.s3.yandex.net/frontend-developer/cards-compressed/baikal.jpg"}],u={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input-error",errorClass:"popup__error_visible"},d=function(e,t,n){errorElement=e.querySelector(".".concat(t.id,"-error")),t.classList.remove(n.inputErrorClass),errorElement.classList.remove(n.errorClass),errorElement.textContent=""},p=function(){inputElement.validity.patternMismatch?inputElement.setCustomValidity(inputElement.dataset.errorMessage):inputElement.setCustomValidity(""),formInput.validity.valid?d(formElement,inputElement,u):function(e,t,n,o){var r=e.querySelector(".".concat(t.id,"-error"));t.classList.add(o.inputErrorClass),r.textContent=n,errorElementElement.classList.add(o.errorClass)}(formElement,inputElement,formInput.validationMessage,u)};function m(e,t,n){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?t.classList.remove(n.inactiveButtonClass):t.classList.add(n.inactiveButtonClass)}function f(e,t){var n=Array.from(e.querySelectorAll(t.inputSelector)),o=e.querySelector(t.submitButtonSelector);n.forEach((function(n){return d(e,n,t)})),e.reset(),m(n,o,t)}var h=document.querySelector(".places__list"),_=document.querySelector(".profile__edit-button"),v=document.querySelector(".popup_type_edit"),y=document.querySelector(".profile__title"),g=document.querySelector(".profile__description"),k=document.forms["edit-profile"],b=k.elements.name,E=k.elements.description,S=document.querySelector(".profile__add-button"),q=document.querySelector(".popup_type_new-card"),L=(document.querySelector(".popup_type_image"),document.querySelector(".popup__image"),document.querySelector(".popup__caption"),document.forms["new-place"]),C=L.elements["place-name"],x=L.elements.link,A=Array.from(document.querySelectorAll(".popup")),U=document.querySelector(".profile__image"),j=(document.querySelector(".popup_type_change-avatar"),document.querySelector("#avatar-input"));Promise.all([fetch("".concat(o.baseUrl,"/users/me"),{method:"GET",headers:o.headers}).then(r).catch((function(e){console.log(e)})),fetch("".concat(o.baseUrl,"/cards"),{method:"GET",headers:o.headers}).then(r).catch((function(e){console.log(e)}))]).then((function(){l.forEach((function(e){return function(e,t,n,o,r){var c=r._id,i=a(e,t,n);e.likes.some((function(e){return e.id===c}))&&i.querySelector(".card__like-button").classList.add("card__like-button_is-active"),h.append(i)}(e,s,i,0,userInfo)}))})).catch((function(e){console.log(e)})),k.addEventListener("submit",(function(e){e.preventDefault(),y.textContent=b.value,g.textContent=E.value,(void fetch("".concat(o.baseUrl,"/users/me"),{method:"PATCH",headers:o.headers,body:JSON.stringify({name:undefined,about:undefined})}).then(r)).then((function(){t(v)})).catch((function(e){console.log(e)}))})),function(e){e.forEach((function(e){e.querySelector(".popup__close").addEventListener("click",(function(n){t(e)})),e.addEventListener("click",(function(n){n.target.classList.contains("popup_is-opened")&&t(e)}))}))}(A),_.addEventListener("click",(function(){b.value=y.textContent,E.value=g.textContent,e(v),f(k,u)})),S.addEventListener("click",(function(){e(q),f(L,u)})),L.addEventListener("submit",(function(e){e.preventDefault();var n={name:C.value,link:x.value};h.prepend(a(n,s,i)),L.reset(),t(q),(void fetch("".concat(o.baseUrl,"/cards"),{method:"POST",headers:o.headers,body:JSON.stringify({name:undefined,link:undefined})}).then(r)).then((function(){h.prepend(a(n,s,i)),L.reset(),t(q)})).catch((function(e){console.log(e)}))})),popupChangeAvatar.addEventListener("submit",(function(e){var n;e.preventDefault(),e.submitter.textContent="Сохранение...",(n=j.value,fetch("".concat(o.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:o.headers,body:JSON.stringify({avatar:n})}).then(r).catch((function(e){console.log(e)}))).then((function(e){var n;n=e.avatar,U.style.backgroundImage="url(".concat(n,")"),t(popupChangeAvatar)})).catch((function(e){console.log(e)})).finally((function(){e.submitter.textContent="Сохранение..."}))})),function(e){Array.from(document.querySelectorAll(e.formSelector)).forEach((function(t){!function(e,t){var n=Array.from(e.querySelectorAll(t.formSelector));n.forEach((function(e){e.addEventListener("input",(function(){p(),m(n,buttonElement,t)}))}))}(t,e)}))}(u)})();